# 패션 커머스 시스템 - 포인트 유즈케이스

## 도메인 설명

### 포인트(Point) 도메인

포인트 도메인은 사용자의 잔액 관리 및 충전/사용 내역을 관리합니다.

- **포인트 잔액(Balance)**: 사용자가 보유한 현재 포인트 금액
- **충전(Charge)**: 외부 결제 수단을 통한 포인트 충전
- **사용(Use)**: 주문/결제 시 포인트 차감 (주문 도메인에서 처리)

### 비즈니스 룰

- **최소 충전 금액**: 1,000원
- **최대 충전 금액**: 2,000,000원
- **포인트 유효기간**: 없음 (무기한 사용 가능)
- **충전 단위**: 원 단위 (소수점 불가)

## 구현해야 하는 유즈케이스

### 1. 포인트 조회

#### 1.1 현재 포인트 잔액 조회

- 사용자의 현재 포인트 잔액 확인

### 2. 포인트 충전

#### 2.1 충전 요청 생성

- 충전할 금액으로 충전 요청 생성
- 충전 금액 범위 검증 (1,000원 ~ 2,000,000원)
- Snowflake 알고리즘으로 고유 ID 발급
- 충전 요청 상태: PENDING
- 클라이언트는 발급받은 ID로 MOCK PG 결제 진행 한다고 가정

#### 2.2 충전 검증 및 완료

- MOCK PG에서 처리된 결제 정보 검증
- MOCK PG API로 실제 결제 금액 조회
- 충전 요청 금액과 MOCK PG 결제 금액 일치 확인
- 검증 완료 후 포인트 충전 및 거래 내역 생성
- 중복 충전 방지 (멱등성 보장)
- 네트워크 문제나 새로고침으로 API 호출 실패 시 MOCK PG와 대사 필요

## API 요약

### 포인트 관리 API

| Method | Endpoint                | 설명                  | 주요 기능                             |
| ------ | ----------------------- | --------------------- | ------------------------------------- |
| `GET`  | `/points/balance`       | 포인트 잔액 조회      | 현재 포인트 잔액 및 최근 거래 요약    |
| `POST` | `/points/charge`        | 포인트 충전 요청 생성 | 충전 요청 생성 및 Snowflake ID 발급   |
| `POST` | `/points/charge/verify` | 포인트 충전 검증 완료 | Mock PG 결제 검증 및 포인트 충전 완료 |

## 요청/응답 예시

### 1. 포인트 잔액 조회

**Request**

```http
GET /points/balance
```

**Response**

```json
{
  "userId": 1,
  "balance": 50000
}
```

### 2. 포인트 충전 요청 생성

**Request**

```json
POST /points/charge

{
  "amount": 50000
}
```

**Response**

```json
{
  "chargeRequestId": "1234567890123456789",
  "amount": 50000,
  "status": "PENDING",
  "createdAt": "2025-10-28T11:00:00Z"
}
```

### 3. 포인트 충전 검증 및 완료

**Request**

```json
POST /points/charge/verify

{
  "paymentId": "payment_1234567890",
  "chargeRequestId": "1234567890123456789"
}
```

**Response**

```json
{
  "chargeRequestId": "1234567890123456789",
  "status": "COMPLETED",
  "amount": 50000,
  "previousBalance": 20000,
  "currentBalance": 70000
}
```

## 오류 처리

### 충전 요청 생성 시

- 충전 금액이 범위를 벗어난 경우 (최소 1,000원, 최대 2,000,000원)

### 충전 검증 시

- 충전 요청 금액과 PG 결제 금액 불일치
- 중복 충전 요청 (멱등성 보장)
- 존재하지 않는 충전 요청 ID